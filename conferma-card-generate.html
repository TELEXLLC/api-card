<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate Conferma Virtual Card</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen py-8">
  <div class="max-w-4xl mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">
        <i class="fas fa-credit-card text-blue-600 mr-3"></i>
        Conferma Virtual Card Generator
      </h1>
      <p class="text-gray-600">Create virtual cards using the Conferma API</p>
    </div>

    <!-- Main Form -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-6">Card Details</h2>
      
      <!-- Basic Information -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="spendType" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-tag mr-2"></i>Spend Type *
          </label>
          <select id="spendType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="Generic">Generic</option>
            <option value="Hotel">Hotel</option>
            <option value="Air">Air</option>
            <option value="Rail">Rail</option>
            <option value="Transport">Transport</option>
          </select>
        </div>

        <div>
          <label for="consumerReference" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-hashtag mr-2"></i>Consumer Reference
          </label>
          <input type="text" id="consumerReference" placeholder="e.g., BOOKING-12345" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
      </div>

      <!-- Amount Information -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="amount" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-dollar-sign mr-2"></i>Amount *
          </label>
          <input type="number" id="amount" value="100.00" min="0" step="0.01"
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="currencyCode" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-coins mr-2"></i>Currency *
          </label>
          <select id="currencyCode" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
            <option value="CAD">CAD</option>
          </select>
        </div>
      </div>

      <!-- Payment Range -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="startDate" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-calendar-alt mr-2"></i>Start Date *
          </label>
          <input type="date" id="startDate" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="endDate" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-calendar-check mr-2"></i>End Date *
          </label>
          <input type="date" id="endDate" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
      </div>

      <!-- Supplier Information -->
      <div class="border-t pt-6 mb-6">
        <h3 class="text-lg font-medium text-gray-800 mb-4">
          <i class="fas fa-building mr-2"></i>Supplier Information *
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
          <div>
            <label for="supplierName" class="block text-sm font-medium text-gray-700 mb-2">Supplier Name *</label>
            <input type="text" id="supplierName" placeholder="e.g., Hotel ABC" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <div>
            <label for="supplierReference" class="block text-sm font-medium text-gray-700 mb-2">Supplier Reference</label>
            <input type="text" id="supplierReference" placeholder="e.g., INV-67890" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
          <div>
            <label for="supplierAddress1" class="block text-sm font-medium text-gray-700 mb-2">Address Line 1 *</label>
            <input type="text" id="supplierAddress1" placeholder="123 Main Street" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <div>
            <label for="supplierCity" class="block text-sm font-medium text-gray-700 mb-2">City *</label>
            <input type="text" id="supplierCity" placeholder="New York" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label for="supplierState" class="block text-sm font-medium text-gray-700 mb-2">State *</label>
            <input type="text" id="supplierState" placeholder="NY" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <div>
            <label for="supplierPostalCode" class="block text-sm font-medium text-gray-700 mb-2">Postal Code *</label>
            <input type="text" id="supplierPostalCode" placeholder="10001" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <div>
            <label for="supplierCountryCode" class="block text-sm font-medium text-gray-700 mb-2">Country Code *</label>
            <select id="supplierCountryCode" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="US">US</option>
              <option value="CA">CA</option>
              <option value="GB">GB</option>
              <option value="DE">DE</option>
              <option value="FR">FR</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Advanced Options -->
      <div class="border-t pt-6 mb-6">
        <h3 class="text-lg font-medium text-gray-800 mb-4">
          <i class="fas fa-cogs mr-2"></i>Advanced Options
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="flex items-center">
              <input type="checkbox" id="isAdvancedPurchase" class="mr-2">
              <span class="text-sm text-gray-700">Advanced Purchase</span>
            </label>
          </div>

          <div>
            <label class="flex items-center">
              <input type="checkbox" id="straightThroughProcessingEnabled" class="mr-2">
              <span class="text-sm text-gray-700">Straight Through Processing</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-4">
        <button id="generateCardBtn" 
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-md transition duration-200 flex items-center justify-center">
          <i class="fas fa-credit-card mr-2"></i>
          Generate Virtual Card
        </button>
        
        <button id="testApiBtn" 
                class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-md transition duration-200 flex items-center justify-center">
          <i class="fas fa-flask mr-2"></i>
          Test API
        </button>
      </div>
    </div>

    <!-- Response Section -->
    <div class="bg-white rounded-lg shadow-lg p-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        <i class="fas fa-terminal mr-2"></i>API Response
      </h2>
      <div id="response" class="bg-gray-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap">
        Response will appear here...
      </div>
    </div>

    <!-- Test Endpoints Section -->
    <div class="bg-white rounded-lg shadow-lg p-8 mt-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        <i class="fas fa-vials mr-2"></i>API Test Endpoints
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <button onclick="testEndpoint('/test')" 
                class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-md transition duration-200">
          <i class="fas fa-info-circle mr-2"></i>Test Info
        </button>
        <button onclick="testEndpoint('/test/conferma-card')" 
                class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition duration-200">
          <i class="fas fa-credit-card mr-2"></i>Test Conferma
        </button>
        <button onclick="testEndpoint('/test/mastercard')" 
                class="bg-orange-600 hover:bg-orange-700 text-white py-2 px-4 rounded-md transition duration-200">
          <i class="fas fa-cc-mastercard mr-2"></i>Test Mastercard
        </button>
        <button onclick="testEndpoint('/test/all')" 
                class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-md transition duration-200">
          <i class="fas fa-list-check mr-2"></i>Test All
        </button>
      </div>
    </div>
  </div>

  <script>
    const responseBox = document.getElementById('response');

    // Set default dates
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const endDate = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
      
      document.getElementById('startDate').value = today.toISOString().split('T')[0];
      document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
    });

    async function generateCard() {
      responseBox.textContent = 'Generating card... Please wait.';
      responseBox.className = 'bg-gray-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap';

      const body = {
        spendType: document.getElementById('spendType').value,
        consumerReference: document.getElementById('consumerReference').value || undefined,
        supplierReference: document.getElementById('supplierReference').value || undefined,
        deploymentAmount: {
          amount: parseFloat(document.getElementById('amount').value),
          currencyCode: document.getElementById('currencyCode').value
        },
        paymentRange: {
          startDate: document.getElementById('startDate').value,
          endDate: document.getElementById('endDate').value
        },
        supplier: {
          name: document.getElementById('supplierName').value,
          address: {
            line1: document.getElementById('supplierAddress1').value,
            city: document.getElementById('supplierCity').value,
            state: document.getElementById('supplierState').value,
            postalCode: document.getElementById('supplierPostalCode').value,
            countryCode: document.getElementById('supplierCountryCode').value
          }
        },
        isAdvancedPurchase: document.getElementById('isAdvancedPurchase').checked,
        straightThroughProcessingEnabled: document.getElementById('straightThroughProcessingEnabled').checked
      };

      try {
        const response = await fetch('/conferma-card', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(body),
        });

        const responseData = await response.json();

        if (!response.ok) {
          responseBox.textContent = 'Error: ' + (responseData.message || JSON.stringify(responseData, null, 2));
          responseBox.className = 'bg-red-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-red-800';
          return;
        }

        responseBox.className = 'bg-green-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-green-800';
        responseBox.textContent = JSON.stringify(responseData, null, 2);

      } catch (error) {
        responseBox.className = 'bg-red-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-red-800';
        responseBox.textContent = 'Fetch error: ' + error.message;
      }
    }

    async function testApi() {
      responseBox.textContent = 'Running API test... Please wait.';
      responseBox.className = 'bg-gray-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap';

      try {
        const response = await fetch('/test/conferma-card');
        const responseData = await response.json();

        if (responseData.status === 'PASS') {
          responseBox.className = 'bg-green-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-green-800';
        } else if (responseData.status === 'FAIL') {
          responseBox.className = 'bg-yellow-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-yellow-800';
        } else {
          responseBox.className = 'bg-red-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-red-800';
        }

        responseBox.textContent = JSON.stringify(responseData, null, 2);

      } catch (error) {
        responseBox.className = 'bg-red-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-red-800';
        responseBox.textContent = 'Test error: ' + error.message;
      }
    }

    async function testEndpoint(endpoint) {
      responseBox.textContent = `Testing ${endpoint}... Please wait.`;
      responseBox.className = 'bg-gray-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap';

      try {
        const response = await fetch(endpoint);
        const responseData = await response.json();

        if (responseData.status === 'PASS' || responseData.status === 'OK') {
          responseBox.className = 'bg-green-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-green-800';
        } else if (responseData.status === 'FAIL' || responseData.status === 'SKIP') {
          responseBox.className = 'bg-yellow-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-yellow-800';
        } else {
          responseBox.className = 'bg-red-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-red-800';
        }

        responseBox.textContent = JSON.stringify(responseData, null, 2);

      } catch (error) {
        responseBox.className = 'bg-red-100 rounded-md p-4 font-mono text-sm overflow-auto max-h-96 whitespace-pre-wrap text-red-800';
        responseBox.textContent = `Error testing ${endpoint}: ` + error.message;
      }
    }

    document.getElementById('generateCardBtn').addEventListener('click', generateCard);
    document.getElementById('testApiBtn').addEventListener('click', testApi);
  </script>
</body>
</html>
